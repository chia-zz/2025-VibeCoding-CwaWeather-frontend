<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>å¤©ç©ºçš„è²éŸ³</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: "Kiwi Maru", serif;
        min-height: 100vh;
        color: #1a1a1a;
        overflow-x: hidden;
        transition: background 1.5s ease;
      }

      /* èƒŒæ™¯æ¼¸å±¤ - æ–°æµ·èª é¢¨æ ¼ */
      .bg-dawn {
        background: linear-gradient(
          to bottom,
          #7d91ca 0%,
          #9bc4e8 50%,
          #f5e6bd 100%
        );
      }
      .bg-morning {
        background: linear-gradient(
          to bottom,
          #83b7df 0%,
          #9bc4e8 50%,
          #daeaf9 100%
        );
      }
      .bg-noon {
        background: linear-gradient(
          to bottom,
          #108ed1 0%,
          #42ade1 50%,
          #a9d2ee 100%
        );
      }
      .bg-afternoon {
        background: linear-gradient(
          to bottom,
          #215a8d 0%,
          #56b2e1 50%,
          #cbe0f3 100%
        );
      }
      .bg-sunset {
        background: linear-gradient(
          to bottom,
          #a7b8d7 0%,
          #d4c8d2 50%,
          #ffe5d4 100%
        );
      }
      .bg-evening {
        background: linear-gradient(
          to bottom,
          #615f94 0%,
          #a882b9 50%,
          #e5beaf 100%
        );
      }
      .bg-night {
        background: linear-gradient(
          to bottom,
          #191d27 0%,
          #102751 50%,
          #224376 100%
        );
      }
      .bg-rainy {
        background: linear-gradient(
          to bottom,
          #4c5b7c 0%,
          #7e89a5 50%,
          #a1a9c0 100%
        );
      }

      /* ç»ç’ƒè³ªæ„Ÿå¡ç‰‡ */
      .glass-card {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      /* ä¸‹æ‹‰å¼é¸å–® */
      .city-dropdown {
        position: relative;
        display: inline-block;
        width: 100%;
        max-width: 300px;
        margin: 15px auto;
      }

      .dropdown-btn {
        width: 100%;
        padding: 12px 20px;
        background: rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(15px);
        border: 2px solid rgba(255, 255, 255, 0.5);
        border-radius: 15px;
        color: #1a1a1a;
        font-weight: 500;
        cursor: pointer;
        font-size: 1.1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
      }

      .dropdown-btn:hover {
        background: rgba(255, 255, 255, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .dropdown-content {
        display: none;
        position: absolute;
        width: 100%;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 2px solid rgba(255, 255, 255, 0.8);
        border-radius: 15px;
        margin-top: 5px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 100;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .dropdown-content.show {
        display: block;
      }

      .dropdown-item {
        padding: 12px 20px;
        cursor: pointer;
        color: #1a1a1a;
        font-weight: 400;
        transition: all 0.2s ease;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      .dropdown-item:last-child {
        border-bottom: none;
      }

      .dropdown-item:hover {
        background: rgba(100, 150, 200, 0.2);
        font-weight: 500;
      }

      .dropdown-item.selected {
        background: rgba(100, 150, 200, 0.3);
        font-weight: 600;
      }

      /* Loading å‹•ç•« */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
        background: linear-gradient(to bottom, #56ccf2 0%, #2f80ed 100%);
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .cloud-icon {
        font-size: 5rem;
        animation: float 3s ease-in-out infinite;
        filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.2));
      }

      /* å¤©æ°£å¡ç‰‡å‹•ç•« */
      .fade-in {
        animation: fadeIn 0.8s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* æº«åº¦é¡¯ç¤º */
      .temp-display {
        font-size: 5rem;
        font-weight: 700;
        line-height: 1;
        text-shadow: 2px 2px 20px rgba(0, 0, 0, 0.1);
      }

      /* ç¨å¾Œé å ±å¡ç‰‡ */
      .forecast-scroll {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 15px;
        padding: 0 20px 20px;
      }

      .mini-forecast-card {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        padding: 20px 15px;
        text-align: center;
        transition: all 0.3s ease;
      }

      .mini-forecast-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>

  <body id="mainBody" class="bg-morning">
    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
      <div class="cloud-icon">â˜ï¸</div>
      <p
        class="text-white text-xl mt-6 font-medium"
        style="text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3)"
      >
        è§€å¯Ÿå¤©ç©ºä¸­...
      </p>
    </div>

    <!-- Status Bar -->
    <div
      class="glass-card sticky top-0 z-50 px-5 py-4 flex justify-between items-center"
    >
      <div
        id="currentCityName"
        class="text-gray-800 text-xl font-bold drop-shadow-sm"
        style="text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5)"
      >
        ğŸ“ è‡ºåŒ—å¸‚
      </div>
      <div
        id="updateTime"
        class="text-gray-700 text-sm bg-white bg-opacity-30 px-3 py-1 rounded-full"
        style="text-shadow: 0 1px 1px rgba(255, 255, 255, 0.3)"
      >
        æ›´æ–°ä¸­...
      </div>
    </div>

    <!-- City Dropdown -->
    <div class="px-5">
      <div class="city-dropdown">
        <button class="dropdown-btn" id="dropdownBtn">
          <span id="selectedCity">è‡ºåŒ—å¸‚</span>
          <span>â–¼</span>
        </button>
        <div class="dropdown-content" id="dropdownContent">
          <div class="dropdown-item selected" data-city="è‡ºåŒ—å¸‚">è‡ºåŒ—å¸‚</div>
          <div class="dropdown-item" data-city="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</div>
          <div class="dropdown-item" data-city="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</div>
          <div class="dropdown-item" data-city="è‡ºä¸­å¸‚">è‡ºä¸­å¸‚</div>
          <div class="dropdown-item" data-city="è‡ºå—å¸‚">è‡ºå—å¸‚</div>
          <div class="dropdown-item" data-city="é«˜é›„å¸‚">é«˜é›„å¸‚</div>
          <div class="dropdown-item" data-city="åŸºéš†å¸‚">åŸºéš†å¸‚</div>
          <div class="dropdown-item" data-city="æ–°ç«¹å¸‚">æ–°ç«¹å¸‚</div>
          <div class="dropdown-item" data-city="æ–°ç«¹ç¸£">æ–°ç«¹ç¸£</div>
          <div class="dropdown-item" data-city="è‹—æ —ç¸£">è‹—æ —ç¸£</div>
          <div class="dropdown-item" data-city="å½°åŒ–ç¸£">å½°åŒ–ç¸£</div>
          <div class="dropdown-item" data-city="å—æŠ•ç¸£">å—æŠ•ç¸£</div>
          <div class="dropdown-item" data-city="é›²æ—ç¸£">é›²æ—ç¸£</div>
          <div class="dropdown-item" data-city="å˜‰ç¾©å¸‚">å˜‰ç¾©å¸‚</div>
          <div class="dropdown-item" data-city="å˜‰ç¾©ç¸£">å˜‰ç¾©ç¸£</div>
          <div class="dropdown-item" data-city="å±æ±ç¸£">å±æ±ç¸£</div>
          <div class="dropdown-item" data-city="å®œè˜­ç¸£">å®œè˜­ç¸£</div>
          <div class="dropdown-item" data-city="èŠ±è“®ç¸£">èŠ±è“®ç¸£</div>
          <div class="dropdown-item" data-city="è‡ºæ±ç¸£">è‡ºæ±ç¸£</div>
          <div class="dropdown-item" data-city="æ¾æ¹–ç¸£">æ¾æ¹–ç¸£</div>
          <div class="dropdown-item" data-city="é‡‘é–€ç¸£">é‡‘é–€ç¸£</div>
          <div class="dropdown-item" data-city="é€£æ±Ÿç¸£">é€£æ±Ÿç¸£</div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div
      class="container mx-auto px-5 py-6 max-w-2xl fade-in"
      id="mainContent"
      style="display: none"
    >
      <!-- Hero Card -->
      <div id="heroCard"></div>

      <!-- Future Forecasts -->
      <h3
        class="text-gray-800 text-lg font-bold mb-4 px-1 drop-shadow-sm"
        style="text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5)"
      >
        ç¨å¾Œé å ±
      </h3>
      <div class="forecast-scroll" id="futureForecasts"></div>
    </div>

    <script>
      const API_BASE_URL = "https://2025vc-weather.zeabur.app/api/weather";
      let currentCity = "è‡ºåŒ—å¸‚";

      // å¤©æ°£iconæ˜ å°„ - æ›´ç²¾ç·»çš„emojiçµ„åˆ
      function getWeatherIcon(weather) {
        if (!weather) return "ğŸŒ¤ï¸";
        if (weather.includes("æ™´")) return "â˜€ï¸";
        if (weather.includes("å¤šé›²")) return "â›…";
        if (weather.includes("é™°")) return "â˜ï¸";
        if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
        if (weather.includes("é›·")) return "â›ˆï¸";
        if (weather.includes("é›ª")) return "â„ï¸";
        return "ğŸŒ¤ï¸";
      }

      // æ™‚æ®µåˆ¤æ–·
      function getTimePeriod(startTime) {
        const hour = new Date(startTime).getHours();
        if (hour >= 5 && hour < 7) return "æ¸…æ™¨";
        if (hour >= 7 && hour < 11) return "æ—©æ™¨";
        if (hour >= 11 && hour < 14) return "ä¸­åˆ";
        if (hour >= 14 && hour < 17) return "ä¸‹åˆ";
        if (hour >= 17 && hour < 19) return "é»ƒæ˜";
        if (hour >= 19 && hour < 22) return "æ™šä¸Š";
        return "æ·±å¤œ";
      }

      // èƒŒæ™¯é¡è‰²åˆ‡æ›
      function setBackgroundByTime(startTime, rainProb) {
        const hour = new Date(startTime).getHours();
        const body = document.getElementById("mainBody");

        // é›¨å¤©å„ªå…ˆ
        if (parseInt(rainProb) > 50) {
          body.className = "bg-rainy";
          return;
        }

        // æ ¹æ“šæ™‚æ®µè¨­å®šèƒŒæ™¯
        if (hour >= 5 && hour < 7) body.className = "bg-dawn";
        else if (hour >= 7 && hour < 11) body.className = "bg-morning";
        else if (hour >= 11 && hour < 14) body.className = "bg-noon";
        else if (hour >= 14 && hour < 17) body.className = "bg-afternoon";
        else if (hour >= 17 && hour < 19) body.className = "bg-sunset";
        else if (hour >= 19 && hour < 22) body.className = "bg-evening";
        else body.className = "bg-night";
      }

      // ç©¿æ­å»ºè­°
      function getAdvice(rainProb, maxTemp) {
        let rainIcon = "ğŸŒ‚";
        let rainText = "å…å¸¶å‚˜";
        if (parseInt(rainProb) > 30) {
          rainIcon = "â˜‚ï¸";
          rainText = "è¨˜å¾—å¸¶å‚˜å–”";
        }

        let clothIcon = "ğŸ‘•";
        let clothText = "Easyèˆ’é©ç©¿";
        if (parseInt(maxTemp) >= 28) {
          clothIcon = "ğŸ½";
          clothText = "ä»Šä»”æ—¥çŸ­è¢–å°±ğŸ‰‘";
        } else if (parseInt(maxTemp) <= 20) {
          clothIcon = "ğŸ§¥";
          clothText = "é˜¿å¬¤è®“ä½ åŠ ä»¶å¤–å¥—";
        }

        return { rainIcon, rainText, clothIcon, clothText };
      }

      // æ¸²æŸ“å¤©æ°£è³‡æ–™
      function renderWeather(data) {
        document.getElementById(
          "currentCityName"
        ).textContent = `ğŸ“ ${data.city}`;

        const forecasts = data.forecasts;
        const current = forecasts[0];
        const others = forecasts.slice(1);

        // è¨­å®šèƒŒæ™¯
        setBackgroundByTime(current.startTime, current.rain);

        // æ¸²æŸ“ä¸»å¡ç‰‡
        const advice = getAdvice(current.rain, current.maxTemp);
        const period = getTimePeriod(current.startTime);
        const avgTemp = Math.round(
          (parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2
        );

        document.getElementById("heroCard").innerHTML = `
          <div class="glass-card rounded-3xl p-8 mb-6 text-center">
            <div class="text-gray-700 text-sm font-medium mb-4 inline-block px-4 py-1 rounded-full bg-white bg-opacity-30" style="text-shadow: 0 1px 1px rgba(255,255,255,0.5)">
              ${period}
            </div>
            <div class="flex justify-center items-center gap-4 my-6">
              <div style="font-size: 4.5rem; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2))">
                ${getWeatherIcon(current.weather)}
              </div>
              <div class="temp-display text-gray-800" style="text-shadow: 0 2px 4px rgba(255,255,255,0.5)">${avgTemp}Â°</div>
            </div>
            <div class="text-gray-800 text-2xl font-medium mb-6 opacity-90" style="text-shadow: 0 1px 2px rgba(255,255,255,0.5)">${
              current.weather
            }</div>
            
            <div class="grid grid-cols-2 gap-4 pt-6 border-t border-gray-400 border-opacity-30">
              <div class="glass-card rounded-2xl p-4">
                <div class="text-4xl mb-2">${advice.rainIcon}</div>
                <div class="text-gray-800 font-bold text-lg" style="text-shadow: 0 1px 1px rgba(255,255,255,0.5)">${
                  advice.rainText
                }</div>
                <div class="text-gray-700 text-sm opacity-75 mt-1">é™é›¨ç‡ ${
                  current.rain
                }</div>
              </div>
              <div class="glass-card rounded-2xl p-4">
                <div class="text-4xl mb-2">${advice.clothIcon}</div>
                <div class="text-gray-800 font-bold text-lg" style="text-shadow: 0 1px 1px rgba(255,255,255,0.5)">${
                  advice.clothText
                }</div>
                <div class="text-gray-700 text-sm opacity-75 mt-1">æœ€é«˜æº« ${
                  current.maxTemp
                }</div>
              </div>
            </div>
          </div>
        `;

        // æ¸²æŸ“ç¨å¾Œé å ±
        const scrollContainer = document.getElementById("futureForecasts");
        scrollContainer.innerHTML = "";

        const todayDate = new Date().getDate();

        others.forEach((f) => {
          let p = getTimePeriod(f.startTime);
          const fDate = new Date(f.startTime);
          if (fDate.getDate() !== todayDate) {
            p = "æ˜å¤©" + p;
          }

          scrollContainer.innerHTML += `
            <div class="mini-forecast-card">
              <div class="text-gray-700 text-xs font-medium mb-2 bg-white bg-opacity-30 inline-block px-3 py-1 rounded-full" style="text-shadow: 0 1px 1px rgba(255,255,255,0.5)">
                ${p}
              </div>
              <div style="font-size: 2.5rem; margin: 8px 0">
                ${getWeatherIcon(f.weather)}
              </div>
              <div class="text-gray-800 font-bold text-lg mb-1" style="text-shadow: 0 1px 1px rgba(255,255,255,0.5)">
                ${f.minTemp} - ${f.maxTemp}
              </div>
              <div class="text-gray-700 text-sm opacity-75">ğŸ’§ ${f.rain}</div>
            </div>
          `;
        });

        // æ›´æ–°æ™‚é–“
        const now = new Date();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const dayIndex = now.getDay();
        const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];

        document.getElementById(
          "updateTime"
        ).textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
      }

      // æŠ“å–å¤©æ°£è³‡æ–™
      async function fetchWeather(city = null) {
        const url = city
          ? `${API_BASE_URL}/${encodeURIComponent(city)}`
          : `${API_BASE_URL}/current`;

        try {
          const delayPromise = new Promise((resolve) =>
            setTimeout(resolve, 1000)
          );
          const fetchPromise = fetch(url).then((res) => {
            if (!res.ok) throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹ç¢¼: ${res.status}`);
            return res.json();
          });

          const [_, json] = await Promise.all([delayPromise, fetchPromise]);

          if (json.success) {
            renderWeather(json.data);
            document.getElementById("loading").style.display = "none";
            document.getElementById("mainContent").style.display = "block";
          } else {
            throw new Error(json.message || "API å›å‚³éŒ¯èª¤");
          }
        } catch (e) {
          console.error(e);
          alert(`å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼š${e.message}`);
          document.getElementById("loading").style.display = "none";
        }
      }

      // åŸå¸‚ä¸‹æ‹‰é¸å–®åŠŸèƒ½
      const dropdownBtn = document.getElementById("dropdownBtn");
      const dropdownContent = document.getElementById("dropdownContent");
      const selectedCitySpan = document.getElementById("selectedCity");

      // é»æ“ŠæŒ‰éˆ•é–‹é—œé¸å–®
      dropdownBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        dropdownContent.classList.toggle("show");
      });

      // é»æ“Šé¸å–®é …ç›®
      document.querySelectorAll(".dropdown-item").forEach((item) => {
        item.addEventListener("click", function () {
          // ç§»é™¤æ‰€æœ‰ selected class
          document
            .querySelectorAll(".dropdown-item")
            .forEach((i) => i.classList.remove("selected"));
          // åŠ å…¥ç•¶å‰ selected
          this.classList.add("selected");

          // æ›´æ–°é¡¯ç¤ºçš„åŸå¸‚åç¨±
          currentCity = this.dataset.city;
          selectedCitySpan.textContent = currentCity;

          // é—œé–‰é¸å–®
          dropdownContent.classList.remove("show");

          // æŠ“å–è©²åŸå¸‚è³‡æ–™
          fetchWeather(currentCity);
        });
      });

      // é»æ“Šå¤–éƒ¨é—œé–‰é¸å–®
      document.addEventListener("click", function () {
        dropdownContent.classList.remove("show");
      });

      // åˆå§‹è¼‰å…¥
      document.addEventListener("DOMContentLoaded", () => {
        fetchWeather(); // ä½¿ç”¨IPè‡ªå‹•å®šä½
      });
    </script>
  </body>
</html>
